隐私化技术
- 安网4从隐私逻辑上分为两层，一层是隐私层，另一层是透明层。
- 透明层是类比特币的一套可追溯的UTXO体系，安码也是可追溯的智能合约银行账号体系，常规地址和安码地址在透明层，可以相互转账；隐私地址在隐私层，仅常规地址可以与隐私地址互转。
- 初始状态下隐私层没有任何资产，SAFE和原生资产都在透明层。资产从透明层进入隐私层，我们称之为资产隐私化，反之称为透明化。
- 资产隐私化的技术方案采用SafePrivacy算法，基于MimbleWimble和Pedersen 承诺，技术思想如下所示：
  - 资产隐私化只是一个可选方案，安网4并不要求所有交易如此，一切决定权归用户；如果需要透明，仅使用常规地址和安码地址即；如果需要隐私化，则转入隐私地址，并且可以多转几次；
  - 资产隐私化的交易包含三种交易，分别是SAFE2Privacy从常规地址转账到隐私地址，包含常规交易的输入，Privacy2Privacy隐私地址之间转账，Privacy2SAFE隐私地址转账到常规地址，包含常规交易的输出；
  - 隐私层在区块链上以隐私区块的方式体现，每当产生的常规区块数量达到40或50后，或者隐私交易数量达到20或30时，区块生产者会生产一个隐私区块，隐私区块除了同样的区块头外，就是一个大交易，合并了近期在隐私交易池中所有三种上述交易，混淆所有输入和输出。之所以需要一定的时间间隔，是因为需要汇总一定的隐私交易数量，才能产生良好的隐私保护效果。隐私区块在区块链中的比例未限定，可以只占40或50分之一（取决于常规区块数量设置），也可以几乎占100%（如果隐私交易池中一直有多于20或30的隐私交易存在）。
  - Pedersen 承诺 ct = r*G + v*H，其中：
  r 是一个私钥，用作致盲因子， G 是一个椭圆曲线点，他们的乘积 r*G 是 r 在 G 上的公钥。v 是输入金额或输出金额，H 是另一个椭圆曲线点。v 和 r 都不能被推导出来，从而利用了椭圆曲线密码学的基本属性。 r * G + v * H被称为 Pedersen 承诺。
- MimbleWimble交易原理，A要发送给B金额v，输入i，找零c，则:

>	i = v + c =>  i - v - c = 0
	
  如果代入Pedersen 承诺维持这个等式平衡，因而：

>	i - v - c = 0
>	=> r1*G + i*H - (r2*G + v*H) - (r3*G + c*H) = 0
>	=> (r1-r2-r3)*G+(i - v - c )*H =0
>	=> (r1-r2-r3)*G+0*H = 0
	
  r1是由A在接收i的时候随机生成的，r2*G需由B提供，r3需由A随机生成；因而MW交易需要在线完成，或者B提供的地址已带r2*G。这里既然r1，r2，r3都是随机生成的，就不可能要求(r1-r2-r3)*G=0，所以我们设r1-r2-r3=kernel_excess：
	
>	 (r1-r2-r3)*G+0*H = kernel_excess*G +0*H
	 
  到此，只需要用kernel_excess对交易签名，即可证明i是属于A的；
